var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,P2P=function(c,a){var b=new RTCPeerConnection({iceServers:[{urls:"stun:de.zqz.ca"}]},{optional:[{DtlsSrtpKeyAgreement:!0}]}),d=null;this.connected=function(){return!1};this.createAnswer=function(){d.createAnswer()};this.create=function(){d=new P2PSender(b,a)};this.receive=function(){d=new P2PReceiver(b,c,a)}},
P2PComponent=function(c){var a=div({cls:"status"}),b=null,d=function(b){H.empty(a);a.appendChild(div("Session Created, send the following link to the person hwo should receive the file"));a.appendChild(dominate.tags.a({href:"/direct/"+b},"dooad"))},e=function(){console.log("sessionExists");b.createAnswer()},f=function(){console.log("sessionDoesNotExist");H.empty(a);a.appendChild(div("Session does not exist!"))},g=function(){console.log("Connect");H.empty(a);a.appendChild(div("Connected!"))},h=function(){console.log("Disconnect");
H.empty(a);a.appendChild(div("Disconnected!"))},k=div({onclick:function(){console.log("send click");b.create()}.bind(this),cls:"btn"},"Send File...");div({onclick:function(){console.log("receive click");b.receive()}.bind(this),cls:"btn"},"Receive");this.render=function(){0===c.length?a.appendChild(k):a.appendChild(div("Attempting to receive file with id "+c));return a};(function(){var a={connect:g.bind(this),disconnect:h.bind(this),sessionExists:e.bind(this),sessionNotFound:f.bind(this),sessionCreated:d.bind(this)};
b=new P2P(c,a);0!==c.length&&b.receive()})()};
